#!/usr/bin/env bash

echo "🔍 Running linting and formatting before push..."

# Debug information
echo "📊 Debug - Before NVM attempt:"
echo "Which node: $(which node)"
echo "Node version: $(node -v)"

# Try to use NVM's Node.js if available
if [ -s "$HOME/.nvm/nvm.sh" ]; then
  echo "📊 NVM detected, attempting to use it..."
  export NVM_DIR="$HOME/.nvm"
  \. "$NVM_DIR/nvm.sh" # This loads nvm
  
  # Try to use Node.js 20, fallback to 18
  nvm use 20 >/dev/null 2>&1 || nvm use 18 >/dev/null 2>&1
  
  echo "📊 After NVM attempt:"
  echo "Which node: $(which node)"
  echo "Node version: $(node -v)"
fi

# Skip linting if running on Node.js < 18
node_version=$(node -v | cut -d. -f1 | sed 's/v//')
if [ "$node_version" -lt 18 ]; then
  echo "⚠️ Warning: Node.js version $(node -v) is less than 18. ESLint 9 requires Node.js 18.17.0+."
  echo "⚠️ Skipping linting to allow push. Please use Node.js 20+ for development."
  exit 0
fi

# Run linting only if we have a compatible Node.js version
pnpm fix-all 